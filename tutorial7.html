<!DOCTYPE html>
<html>
  <head>
    <title>Using Paths</title>
    <style>
      body,
      html {
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      #svg {
        border: 1px solid;
      }
    </style>
  </head>
  <body>
    <svg id="svg" width="600" height="400"></svg>

    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script>
      const X_RANGE = [0, 600];
      const Y_RANGE = [0, 400];
      function getExtents(data) {
        return d3.extent(data, (d) => d.precipitation);
      }

      function getXScale(data) {
        const scale = d3.scaleLinear().domain([0, data.length]).range(X_RANGE);
        return scale;
      }

      function getYScale(data) {
        const scale = d3.scaleLinear().domain(getExtents(data)).range(Y_RANGE);
        return scale;
      }

      function getLineGen(xScale, yScale) {
        const lineGen = d3
          .line()
          .x((d, i) => xScale(i))
          .y((d) => yScale(d.precipitation))
          .curve(d3.curveLinear);
        return lineGen;
      }

      function handleData(data) {
        const baData = getDataForState(data, "BA");
        const scData = getDataForState(data, "SC");
        const baXScale = getXScale(baData);
        const baYScale = getYScale(baData);
        const scXScale = getXScale(scData);
        const scYScale = getYScale(scData);

        const baLineGen = getLineGen(baXScale, baYScale);
        const scLineGen = getLineGen(scXScale, scYScale);

        function getDataForState(data, state) {
          const arr = data
            .filter((d) => d.state === state)
            .filter((d) => !isNaN(d.precipitation))
            .map((d) => {
              d.precipitation = parseFloat(d.precipitation);
              return d;
            });
          return arr;
        }
        d3.select("#svg")
          .append("path")
          .attr("d", baLineGen(baData))
          .attr("stroke-width", 1)
          .attr("stroke", "blue")
          .attr("fill", "none");
        d3.select("#svg")
          .append("path")
          .attr("d", scLineGen(scData))
          .attr("stroke-width", 1)
          .attr("stroke", "red")
          .attr("fill", "none");
      }

      d3.csv("precipitation.csv").then(handleData);
    </script>
  </body>
</html>
